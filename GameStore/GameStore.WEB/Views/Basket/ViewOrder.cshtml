@model IEnumerable<GameStore.Web.ViewModels.BasketViewModel>

@{
    ViewData["Title"] = "Order";
}

<div>
    <h4>Basket</h4>
    <hr />

    @{
        if (Model.Count() == 0)
        {
            <h5>No items yet</h5>
        }
        else
        { @foreach (var i in Model)
            {
                @if (i.OrderDetails.Count == 0)
                {

                }
                else
                {
                    <dl class="row">
                        <dt class="col-sm-2">
                            @Html.DisplayNameFor(model => model.OrderStatus)
                        </dt>
                        <dd class="col-sm-10">
                            @i.OrderStatus
                        </dd>
                        <dt class="col-sm-2">
                            @Html.DisplayNameFor(model => model.Total)
                            <i>(consideriing on discounts)</i>
                        </dt>
                        <dd class="col-sm-10">
                            @i.Total
                        </dd>
                    </dl>
                    <div>
                        @foreach (var d in i.OrderDetails)
                        {
                            <div class="card mb-1">
                                <div class="card-header">
                                    <b>Product Name: </b><i>@d.ProductName </i>
                                </div>
                                <div class="card-body">
                                    <div class="card-text">
                                        <b>Quantity: </b><i>@d.Quantity </i>
                                    </div>
                                    <div class="card-text">
                                        <b>Price: </b><i>@d.Price </i>
                                    </div>
                                    <div class="card-text">
                                        @{ var discount = d.Discount * 100;}
                                        <b> Discount: </b><i> @discount %</i>
                                    </div>
                                    <div class="card-text">
                                        @{ var priceWithDis = d.Price - (d.Price * (decimal)d.Discount);}
                                        <b>Price with discount: </b><i>@priceWithDis </i>
                                    </div>
                                    <div class="card-footer">
                                        <b><a asp-action="DeleteDetail" asp-route-id="@d.OrderDetailId">Delete </a></b>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (i.OrderDetails.Count != 0)
                    {<div>
                            @{ if (i.OrderStatus == "Open")
                                {

                                    <a asp-action="ViewPayment" class="btn-outline-primary" asp-route-id="@i.OrderId">Make Order</a>

                                }
                                else
                                {
                                    <a asp-action="ViewPayment" class="btn-outline-secondary" asp-route-id="@i.OrderId">Pay Order</a>
                                }
                            }
                        </div>
                    }
                }
                <br />
            }
    }
    <div>
        <a asp-action="Index" asp-controller="Game">Back to List</a>
    </div>
    }
</div>
